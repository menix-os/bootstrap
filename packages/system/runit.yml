packages:
- name: runit
  labels: [ x86_64 ]
  architecture: '@OPTION:arch@'
  source:
    subdir: ports
    url: 'https://smarden.org/runit/runit-2.2.0.tar.gz'
    format: 'tar.gz'
    version: '2.2.0'
    checksum: 'blake2b:46a4b91cf180694a69ade3cabaddb35a89db516ef75e9fc69b8091a5c3570079796b8a4cf227edc74938e182833edcce7af40f01d5cb1b4032993fb094459ede'
    extract_path: 'admin/runit-2.2.0'
    patch-path-strip: 1
  revision: 1
  tools_required:
  - host-gcc
  pkgs_required:
  - mlibc
  configure:
  - args: [ 'cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@' ]
  - args: 'echo @OPTION:arch@-@OPTION:triple@-gcc -O2 -Wall > @THIS_BUILD_DIR@/src/conf-cc'
  - args: 'echo @OPTION:arch@-@OPTION:triple@-gcc > @THIS_BUILD_DIR@/src/conf-ld'
  - args: 'sed -i s/-static// src/Makefile'
  - args: 'sed -i 1s/utmpset// src/Makefile'
  - args: 'sed -i /utmpset/d package/commands'
  build:
  - args: [ 'make', '-j@PARALLELISM@', '-C', 'src', 'chkshsgr', 'choose', 'compile', 'hasshsgr.h1', 'hasshsgr.h2', 'load', 'tryshsgr.c', 'warn-shsgr' ]
  - args: 'cat @THIS_BUILD_DIR@/src/hasshsgr.h1 > @THIS_BUILD_DIR@/src/hasshsgr.h'
  - args: 'cat @THIS_BUILD_DIR@/src/uw_tmp.h1 > @THIS_BUILD_DIR@/src/uw_tmp.h'
  - args: [ 'make', '-j@PARALLELISM@', '-C', 'src' ]
  - args: 'install -Dt @THIS_COLLECT_DIR@/bin $(sed s,^,src/, @THIS_BUILD_DIR@/package/commands)'
