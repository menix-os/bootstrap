sources:
- name: mlibc
  subdir: 'sources'
  git: 'https://github.com/menix-os/mlibc.git'
  branch: 'add-menix'
  version: '0.0.0'

packages:
- name: mlibc-headers
  labels: [ x86_64 ]
  architecture: '@OPTION:arch@'
  from_source: mlibc
  revision: 1
  configure:
  - args:
    - 'meson'
    - 'setup'
    - '--cross-file'
    - '@SOURCE_ROOT@/support/meson-@OPTION:arch@.cross-file'
    - '--prefix=/usr'
    - '-Dheaders_only=true'
    - '@THIS_SOURCE_DIR@'
  build:
  - args: [ 'ninja' ]
  - args: [ 'ninja', 'install' ]
    environ:
      DESTDIR: '@THIS_COLLECT_DIR@'

- name: mlibc
  labels: [ x86_64 ]
  architecture: '@OPTION:arch@'
  from_source: mlibc
  revision: 1
  tools_required:
  - host-gcc-bootstrap
  pkgs_required:
  - mlibc-headers
  configure:
  - args:
    - 'meson'
    - 'setup'
    - '--cross-file'
    - '@SOURCE_ROOT@/support/meson-@OPTION:arch@.cross-file'
    - '--prefix=/usr'
    - '--libdir=lib'
    - '-Dno_headers=true'
    - '@THIS_SOURCE_DIR@'
  build:
  - args: [ 'ninja' ]
  - args: [ 'ninja', 'install' ]
    environ:
      DESTDIR: '@THIS_COLLECT_DIR@'
  - args: [ 'ln', '-sf', 'crt0.o', '@THIS_COLLECT_DIR@/usr/lib/crt1.o' ]
