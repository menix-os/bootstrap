diff --git openrc-clean/meson.build openrc-workdir/meson.build
index c1566f9..4c47380 100644
--- openrc-clean/meson.build
+++ openrc-workdir/meson.build
@@ -39,6 +39,8 @@ kvm_dep = []
 
 if os == 'linux'
   cap_dep = dependency('libcap', version: '>=2.33')
+elif os == 'menix'
+  kvm_dep = []
 elif os.contains('bsd') or os == 'dragonfly'
   kvm_dep = cc.find_library('kvm')
 endif
@@ -95,7 +97,7 @@ if get_option('buildtype').startswith('debug')
   c_flags += '-DRC_DEBUG'
 endif
 
-if os == 'linux'
+if os == 'linux' or os == 'menix'
   c_flags += '-D_DEFAULT_SOURCE'
 elif os == 'freebsd'
   c_flags += '-D_BSD_SOURCE'
diff --git openrc-clean/src/fstabinfo/fstabinfo.c openrc-workdir/src/fstabinfo/fstabinfo.c
index 7ae56ae..db62495 100644
--- openrc-clean/src/fstabinfo/fstabinfo.c
+++ openrc-workdir/src/fstabinfo/fstabinfo.c
@@ -28,7 +28,7 @@
 /* Yay for linux and its non liking of POSIX functions.
    Okay, we could use getfsent but the man page says use getmntent instead
    AND we don't have getfsent on uclibc or dietlibc for some odd reason. */
-#ifdef __linux__
+#if defined(__linux__) || defined(__menix__)
 #  define HAVE_GETMNTENT
 #  include <mntent.h>
 
diff --git openrc-clean/src/librc/librc-daemon.c openrc-workdir/src/librc/librc-daemon.c
index 1902875..d2c15fc 100644
--- openrc-clean/src/librc/librc-daemon.c
+++ openrc-workdir/src/librc/librc-daemon.c
@@ -32,7 +32,7 @@
 #include "helpers.h"
 
 #if defined(__linux__) || (defined (__FreeBSD_kernel__) && defined(__GLIBC__)) \
-	|| defined(__GNU__)
+	|| defined(__GNU__) || defined(__menix__)
 static bool
 pid_is_exec(pid_t pid, const char *exec)
 {
diff --git openrc-clean/src/mountinfo/mountinfo.c openrc-workdir/src/mountinfo/mountinfo.c
index c0187b5..fc45877 100644
--- openrc-clean/src/mountinfo/mountinfo.c
+++ openrc-workdir/src/mountinfo/mountinfo.c
@@ -31,7 +31,7 @@
 #  define statfs statvfs
 #  define F_FLAGS f_flag
 #elif defined(__linux__) || (defined(__FreeBSD_kernel__) && \
-	defined(__GLIBC__)) || defined(__GNU__)
+	defined(__GLIBC__)) || defined(__GNU__) || defined(__menix__)
 #  include <mntent.h>
 #endif
 
@@ -292,7 +292,7 @@ find_mounts(struct args *args)
 }
 
 #elif defined(__linux__) || (defined(__FreeBSD_kernel__) && \
-	defined(__GLIBC__)) || defined(__GNU__)
+	defined(__GLIBC__)) || defined(__GNU__) || defined(__menix__)
 static struct mntent *
 getmntfile(const char *file)
 {
diff --git openrc-clean/src/openrc/rc-logger.c openrc-workdir/src/openrc/rc-logger.c
index e57d380..961c32a 100644
--- openrc-clean/src/openrc/rc-logger.c
+++ openrc-workdir/src/openrc/rc-logger.c
@@ -32,7 +32,7 @@
 #include <unistd.h>
 
 #if defined(__linux__) || (defined(__FreeBSD_kernel__) && defined(__GLIBC__)) \
-	|| defined(__GNU__)
+	|| defined(__GNU__) || defined(__menix__)
 #  include <pty.h>
 #elif defined(__NetBSD__) || defined(__OpenBSD__)
 #  include <util.h>
diff --git openrc-clean/src/openrc-init/meson.build openrc-workdir/src/openrc-init/meson.build
index c5c25c0..80e78d6 100644
--- openrc-clean/src/openrc-init/meson.build
+++ openrc-workdir/src/openrc-init/meson.build
@@ -1,4 +1,4 @@
-if os == 'linux'
+if os == 'linux' or os == 'menix'
   executable('openrc-init', 'openrc-init.c',
     include_directories: incdir,
     dependencies: [rc, einfo, shared, dl_dep, selinux_dep],
diff --git openrc-clean/src/openrc-init/openrc-init.c openrc-workdir/src/openrc-init/openrc-init.c
index 8fc21ca..c9dd547 100644
--- openrc-clean/src/openrc-init/openrc-init.c
+++ openrc-workdir/src/openrc-init/openrc-init.c
@@ -33,7 +33,7 @@
 #include <sys/types.h>
 #include <sys/wait.h>
 #include <poll.h>
-#include <utmp.h>
+#include <utmpx.h>
 
 #ifdef HAVE_SELINUX
 #  include <selinux/selinux.h>
diff --git openrc-clean/src/openrc-run/openrc-run.c openrc-workdir/src/openrc-run/openrc-run.c
index 5dab4a5..d3d122c 100644
--- openrc-clean/src/openrc-run/openrc-run.c
+++ openrc-workdir/src/openrc-run/openrc-run.c
@@ -38,7 +38,7 @@
 #include <inttypes.h>
 
 #if defined(__linux__) || (defined(__FreeBSD_kernel__) && defined(__GLIBC__)) \
-	|| defined(__GNU__)
+	|| defined(__GNU__) || defined(__menix__)
 #  include <pty.h>
 #elif defined(__NetBSD__) || defined(__OpenBSD__)
 #  include <util.h>
diff --git openrc-clean/src/openrc-shutdown/meson.build openrc-workdir/src/openrc-shutdown/meson.build
index 6bb7dd6..373ef6a 100644
--- openrc-clean/src/openrc-shutdown/meson.build
+++ openrc-workdir/src/openrc-shutdown/meson.build
@@ -1,4 +1,4 @@
-if os == 'linux'
+if os == 'linux' or os == 'menix'
   executable('openrc-shutdown',
     ['openrc-shutdown.c', 'broadcast.c', 'sysvinit.c'],
     include_directories: incdir,
diff --git openrc-clean/src/openrc-shutdown/openrc-shutdown.c openrc-workdir/src/openrc-shutdown/openrc-shutdown.c
index 8ffe5a7..0223fb2 100644
--- openrc-clean/src/openrc-shutdown/openrc-shutdown.c
+++ openrc-workdir/src/openrc-shutdown/openrc-shutdown.c
@@ -31,7 +31,7 @@
 #include <strings.h>
 #include <unistd.h>
 #include <time.h>
-#include <utmp.h>
+#include <utmpx.h>
 
 #include "broadcast.h"
 #include "einfo.h"
diff --git openrc-clean/src/shared/meson.build openrc-workdir/src/shared/meson.build
index 2241935..d7646db 100644
--- openrc-clean/src/shared/meson.build
+++ openrc-workdir/src/shared/meson.build
@@ -11,7 +11,7 @@ shared_sources = [
   version_h,
 ]
 
-if os == 'linux'
+if os == 'linux' or os == 'menix'
   shared_sources += 'wtmp.c'
 endif
 
diff --git openrc-clean/src/shared/misc.c openrc-workdir/src/shared/misc.c
index e1f30a4..9020a56 100644
--- openrc-clean/src/shared/misc.c
+++ openrc-workdir/src/shared/misc.c
@@ -634,7 +634,7 @@ cloexec_fds_from(int first)
 {
 	int i;
 	if (close_range(first, UINT_MAX, CLOSE_RANGE_CLOEXEC) < 0) {
-		for (i = getdtablesize() - 1; i >= first; --i)
+		for (i = sysconf(_SC_OPEN_MAX) - 1; i >= first; --i)
 			fcntl(i, F_SETFD, FD_CLOEXEC);
 	}
 }
diff --git openrc-clean/src/shared/wtmp.c openrc-workdir/src/shared/wtmp.c
index 286e539..44b1732 100644
--- openrc-clean/src/shared/wtmp.c
+++ openrc-workdir/src/shared/wtmp.c
@@ -20,7 +20,7 @@
 #include <sys/time.h>
 #include <sys/types.h>
 #include <sys/utsname.h>
-#include <utmp.h>
+#include <utmpx.h>
 
 #include "wtmp.h"
 
@@ -28,7 +28,7 @@ void log_wtmp(const char *user, const char *id, pid_t pid, int type,
 		const char *line)
 {
 	struct timeval tv;
-	struct utmp utmp;
+	struct utmpx utmp;
 	struct utsname uname_buf;
 
 	memset(&utmp, 0, sizeof(utmp));
@@ -37,7 +37,6 @@ void log_wtmp(const char *user, const char *id, pid_t pid, int type,
 	utmp.ut_tv.tv_usec = tv.tv_usec;
 	utmp.ut_pid  = pid;
 	utmp.ut_type = type;
-	strncpy(utmp.ut_name, user, sizeof(utmp.ut_name));
 	strncpy(utmp.ut_id  , id  , sizeof(utmp.ut_id  ));
 	strncpy(utmp.ut_line, line, sizeof(utmp.ut_line));
 
@@ -45,5 +44,7 @@ void log_wtmp(const char *user, const char *id, pid_t pid, int type,
 	if (uname(&uname_buf) == 0)
 		strncpy(utmp.ut_host, uname_buf.release, sizeof(utmp.ut_host));
 
-	updwtmp(WTMP_FILE, &utmp);
+#ifndef __menix__
+	updwtmpx(WTMP_FILE, &utmp);
+#endif
 }
diff --git openrc-clean/src/shared/wtmp.h openrc-workdir/src/shared/wtmp.h
index 9691b67..0d5786e 100644
--- openrc-clean/src/shared/wtmp.h
+++ openrc-workdir/src/shared/wtmp.h
@@ -18,7 +18,7 @@
 #ifndef __RC_WTMP_H__
 #define __RC_WTMP_H__
 
-#include <utmp.h>
+#include <utmpx.h>
 #include <sys/types.h>
 
 void log_wtmp(const char *user, const char *id, pid_t pid, int type,
